<%- include('partials/_header') %>
<%- include('partials/_sidebar') %>

<h1>Pomodoro Timer</h1>
<p style="color: var(--text-light); margin-top: -10px; margin-bottom: 30px;">
  Boost your productivity with timed focus sessions.
</p>

<div class="card" style="max-width: 480px; margin: 0 auto; text-align: center;">

  <div class="timer-clock" id="clock">25:00</div>
  
  <div class="timer-progress-bar">
    <div class="timer-progress-fill" id="bar"></div>
  </div>

  <div class="timer-input-group">
    <input type="number" id="minutesInput" value="25" min="1">
    <button class="btn btn-tinted" id="applyBtn">Set Minutes</button>
  </div>

  <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
    <button class="btn" id="startBtn">Start</button>
    <button class="btn btn-tinted" id="pauseBtn">Pause</button>
    <button class="btn btn-tinted" id="resetBtn">Reset</button>
  </div>
  
  <p id="statusMsg" style="margin-top: 15px; color: var(--text-light); min-height: 20px;"></p>
</div>

<audio id="bell" src="/alarm.mp3" preload="auto"></audio>

<script>
  
  const bell = document.getElementById('bell');
  const clock = document.getElementById('clock');
  const bar = document.getElementById('bar');
  const statusMsg = document.getElementById('statusMsg');
  let totalSec = 25 * 60; // Default 25 minutes
  let left = totalSec;
  let t = null;
  let paused = false;

  function fmt(s) {
    const m = Math.floor(s/60);
    const sec = s % 60;
    return String(m).padStart(2,'0') + ':' + String(sec).padStart(2,'0');
  }
  function draw() {
    clock.textContent = fmt(left);
    const pct = totalSec > 0 ? Math.max(0, Math.min(100, ((totalSec - left)/totalSec)*100)) : 0;
    bar.style.width = pct + '%';
  }
  function start() {
    if (t) return;
    paused = false;
    statusMsg.textContent = 'Focus session in progress…';
    t = setInterval(() => {
      if (paused) return;
      left--;
      draw();
      if (left <= 0) {
        clearInterval(t); 
        t = null;
        bell.play();
        statusMsg.textContent = 'Session Completed!  Great work.';
      }
    }, 1000);
  }
  function pauseToggle() {
    if (!t) return;
    paused = !paused;
    document.getElementById('pauseBtn').textContent = paused ? 'Resume' : 'Pause';
    statusMsg.textContent = paused ? 'Paused' : 'Focus session in progress…';
  }
  function reset() {
    if (t) { clearInterval(t); t = null; }
    left = totalSec;
    paused = false;
    document.getElementById('pauseBtn').textContent = 'Pause';
    statusMsg.textContent = '';
    draw();
  }
  function applyMinutes() {
    const minutesInput = document.getElementById('minutesInput');
    const newMinutes = parseInt(minutesInput.value, 10);
    if (!isNaN(newMinutes) && newMinutes > 0) {
      totalSec = newMinutes * 60;
      reset();
    }
  }

  document.getElementById('startBtn').addEventListener('click', start);
  document.getElementById('pauseBtn').addEventListener('click', pauseToggle);
  document.getElementById('resetBtn').addEventListener('click', reset);
  document.getElementById('applyBtn').addEventListener('click', applyMinutes);
  draw();
</script>

<%- include('partials/_footer') %>