<%- include('partials/_header') %>
<%- include('partials/_sidebar') %>

<h1>My Profile</h1>
<p style="color: var(--text-light); margin-top: -10px; margin-bottom: 30px;">
  Here's a summary of your wellness journey.
</p>

<div class="card">
  <div class="profile-header">
    <img src="<%= (user && user.profile_pic) ? user.profile_pic : '/images/default.png' %>" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;" alt="Profile Picture">
    
    <div class="profile-info">
      <div class="profile-details">
        <h2 style="margin: 0;"><%= user ? user.name : 'User' %></h2>
        <p style="color: var(--text-light); margin: 0;"><%= user ? user.email : '' %></p>
      </div>
      <a href="/edit-profile" class="btn" style="margin-top: 10px;">Edit Profile</a>
    </div>
  </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; text-align: center;">
    <div class="card">
      <h3>Habits</h3>
      <p style="font-size: 24px; font-weight: 600;"><%= habits ? habits.done : 0 %> / <%= habits ? habits.total : 0 %> Done</p>
    </div>
    <div class="card">
      <h3>Workouts</h3>
      <p style="font-size: 24px; font-weight: 600;"><%= exercises || 0 %> Completed</p>
    </div>
    <div class="card">
      <h3>Achievements</h3>
      <% if (badges && badges.length) { %>
        <div style="margin-top: 10px;">
          <% badges.forEach(b => { %>
            <span class="badge" style="background-color: var(--primary-color); color: white;"><%= b %></span>
          <% }) %>
        </div>
      <% } else { %>
        <p style="color: var(--text-light);">Keep going to earn badges!</p>
      <% } %>
    </div>
</div>

<div class="card" style="margin-top: 20px;">
  <h3>Mood Summary</h3>
  <div style="max-width: 400px; margin: 20px auto;">
    <canvas id="moodChart"></canvas>
  </div>
</div>

<script>
  const moodData = <%- JSON.stringify(moodData || []) %>;
  if (moodData.length > 0) {
    const labels = moodData.map(item => item.mood);
    const counts = moodData.map(item => item.count);

    new Chart(document.getElementById('moodChart'), {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: counts,
          backgroundColor: ['#fbc02d', '#546e7a', '#388e3c', '#1976d2', '#d32f2f', '#7b1fa2', '#f57c00']
        }]
      },
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });
  }
</script>

<%- include('partials/_footer') %>